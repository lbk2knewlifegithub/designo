# Deploy to PRODUCTION environment
deploy:
  # Use lbk2knewlifegithub namespace
  - okteto ns use lbk2knewlifegithub && okteto kubeconfig
  - envsubst < my-secret.yaml > secret.yaml
  - kubectl apply -f secret.yaml
  - rm secret.yaml

  # Build api auth PRODUCTION
  - okteto build -t okteto.dev/api-auth:${OKTETO_GIT_COMMIT} api -f api/auth.Dockerfile
  - helm upgrade -i api-auth charts/api -n lbk2knewlifegithub -f values/prod/api-auth.yaml --set tag=${OKTETO_GIT_COMMIT}
